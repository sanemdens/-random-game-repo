<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flappy Weed</title>
    <!-- CSS will be added separately -->
</head>
<body>
    <div id="game-container">
        <canvas id="game-canvas" width="320" height="480"></canvas>
        <div class="score">0</div>
        <div class="high-score">Best: 0</div>
        <div class="power-up-indicator hidden">
            <span id="power-up-name">Slow Puff</span>
            <div class="power-up-timer"></div>
        </div>
        
        <div class="start-screen">
            <h2>Flappy Weed</h2>
            <p>Tap to jump, avoid obstacles!</p>
            <p style="color: #ffff00; font-weight: bold;">TIP: Tap continuously to keep your weed afloat!</p>
            <div class="character-select">
                <h3>Choose Your Strain</h3>
                <div class="character-options">
                    <div class="character-option selected" data-character="green">
                        <div class="character-preview green"></div>
                        <span>Green Leaf</span>
                    </div>
                    <div class="character-option" data-character="purple">
                        <div class="character-preview purple"></div>
                        <span>Purple Haze</span>
                    </div>
                    <div class="character-option locked" data-character="gold">
                        <div class="character-preview gold"></div>
                        <span>Golden Kush</span>
                        <div class="lock">ðŸ”’<br>Score 20+</div>
                    </div>
                </div>
            </div>
            <div class="game-mode-select">
                <h3>Game Mode</h3>
                <div class="mode-options">
                    <div class="mode-option selected" data-mode="normal">
                        <span>Normal</span>
                    </div>
                    <div class="mode-option" data-mode="chill">
                        <span>Chill Mode</span>
                        <small>Low gravity</small>
                    </div>
                    <div class="mode-option" data-mode="rush">
                        <span>Rush Mode</span>
                        <small>Fast & intense</small>
                    </div>
                </div>
            </div>
            <button id="start-button">Start Game</button>
            <button id="mute-button" class="icon-button">ðŸ”Š</button>
        </div>
        
        <div class="game-over">
            <h2>Game Over, Man!</h2>
            <p>Your Score: <span id="final-score">0</span></p>
            <p>High Score: <span id="high-score-display">0</span></p>
            <div id="achievement-unlocked" class="hidden">
                <p>ðŸŽ‰ New Strain Unlocked! ðŸŽ‰</p>
                <div class="character-preview gold"></div>
                <p>Golden Kush</p>
            </div>
            <button id="restart-button">Play Again</button>
            <button id="submit-score">Save Score</button>
        </div>

        <div class="pause-menu hidden">
            <h2>Paused</h2>
            <button id="resume-button">Resume</button>
            <button id="quit-button">Quit Game</button>
            <div class="controls">
                <div class="control-option">
                    <span>Sound:</span>
                    <button id="sound-toggle" class="icon-button">ðŸ”Š</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript will be added separately -->
</body>
</html>
body {
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background-color: #222;
    font-family: 'Comic Sans MS', Arial, sans-serif;
    overflow: hidden;
    touch-action: none;
}

#game-container {
    position: relative;
    width: 320px;
    height: 480px;
    overflow: hidden;
    background: linear-gradient(to bottom, #87CEEB, #E0F7FF);
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
    border-radius: 10px;
}

#game-canvas {
    display: block;
}

.hidden {
    display: none !important;
}

.score, .high-score {
    position: absolute;
    font-size: 24px;
    color: white;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
    z-index: 5;
}

.score {
    top: 10px;
    right: 10px;
}

.high-score {
    top: 10px;
    left: 10px;
    font-size: 18px;
}

.power-up-indicator {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background-color: rgba(0, 0, 0, 0.6);
    color: white;
    padding: 5px 10px;
    border-radius: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    z-index: 5;
}

.power-up-timer {
    width: 100%;
    height: 5px;
    background-color: #4CAF50;
    margin-top: 5px;
    border-radius: 3px;
    transform-origin: left;
}

.start-screen, .game-over, .pause-menu {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background-color: rgba(0, 0, 0, 0.8);
    color: white;
    z-index: 10;
    overflow-y: auto;
    padding: 20px;
    box-sizing: border-box;
}

.game-over {
    display: none;
}

.pause-menu {
    justify-content: flex-start;
    padding-top: 100px;
}

h2 {
    color: #4CAF50;
    text-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
    margin-bottom: 10px;
}

button {
    background-color: #4CAF50;
    border: none;
    color: white;
    padding: 12px 24px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    font-size: 16px;
    margin: 10px 2px;
    cursor: pointer;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    transition: all 0.2s ease;
}

button:hover {
    background-color: #45a049;
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
}

button:active {
    transform: translateY(1px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.icon-button {
    width: 40px;
    height: 40px;
    padding: 0;
    border-radius: 50%;
    font-size: 20px;
    display: flex;
    justify-content: center;
    align-items: center;
}

#mute-button {
    position: absolute;
    top: 10px;
    right: 10px;
}

.character-select, .game-mode-select {
    margin: 10px 0;
    width: 80%;
}

.character-options, .mode-options {
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
}

.character-option, .mode-option {
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    padding: 10px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
}

.character-option.selected, .mode-option.selected {
    background-color: rgba(76, 175, 80, 0.3);
    box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
}

.character-option:hover, .mode-option:hover {
    background-color: rgba(255, 255, 255, 0.2);
}

.character-preview {
    width: 40px;
    height: 30px;
    margin: 0 auto 5px;
    position: relative;
}

.character-preview.green {
    background-color: #44A244;
    border-radius: 50%;
}

.character-preview.purple {
    background-color: #8A2BE2;
    border-radius: 50%;
}

.character-preview.gold {
    background-color: #FFD700;
    border-radius: 50%;
}

.character-option.locked {
    opacity: 0.7;
    filter: grayscale(0.7);
}

.lock {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    border-radius: 10px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 12px;
    line-height: 1.2;
}

.mode-option small {
    display: block;
    font-size: 10px;
    opacity: 0.7;
}

.controls {
    margin-top: 20px;
    width: 80%;
}

.control-option {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 10px 0;
}

#achievement-unlocked {
    background-color: rgba(255, 215, 0, 0.2);
    border-radius: 10px;
    padding: 10px;
    margin: 10px 0;
    text-align: center;
}

/* Smoke effect animation */
@keyframes smokeFloat {
    0% { opacity: 0.7; transform: translateY(0) scale(0.8); }
    100% { opacity: 0; transform: translateY(-50px) scale(1.5); }
}

.smoke-particle {
    position: absolute;
    width: 15px;
    height: 15px;
    background-color: rgba(255, 255, 255, 0.6);
    border-radius: 50%;
    animation: smokeFloat 3s ease-out forwards;
}

/* Power-up pulse animation */
@keyframes powerPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
}

.power-active {
    animation: powerPulse 1s infinite;
}
// Game setup and variables
const canvas = document.getElementById('game-canvas');
const ctx = canvas.getContext('2d');
const scoreDisplay = document.querySelector('.score');
const highScoreDisplay = document.querySelector('.high-score');
const startScreen = document.querySelector('.start-screen');
const gameOverScreen = document.querySelector('.game-over');
const pauseMenu = document.querySelector('.pause-menu');
const finalScoreDisplay = document.getElementById('final-score');
const highScoreValueDisplay = document.getElementById('high-score-display');
const startButton = document.getElementById('start-button');
const restartButton = document.getElementById('restart-button');
const submitScoreButton = document.getElementById('submit-score');
const resumeButton = document.getElementById('resume-button');
const quitButton = document.getElementById('quit-button');
const muteButton = document.getElementById('mute-button');
const soundToggle = document.getElementById('sound-toggle');
const achievementUnlocked = document.getElementById('achievement-unlocked');
const powerUpIndicator = document.querySelector('.power-up-indicator');
const powerUpTimer = document.querySelector('.power-up-timer');
const powerUpName = document.getElementById('power-up-name');

// Game state
let gameActive = false;
let gamePaused = false;
let score = 0;
let highScore = localStorage.getItem('flappyWeedHighScore') || 0;
let gameSpeed = 1;
let lastTime = 0;
let animationFrameId;
let characterType = 'green';
let gameMode = 'normal';
let muted = false;
let unlockedCharacters = JSON.parse(localStorage.getItem('unlockedCharacters')) || ['green', 'purple'];

// Game physics
let baseGravity = 0.25;
let gravity = baseGravity;
let jumpForce = -5;
let terminalVelocity = 8;

// Game elements
let pipes = [];
let powerUps = [];
let particles = [];
let clouds = [];
let munchies = [];

// Pipe configuration
let pipeWidth = 70;
let pipeGap = 180;
let pipeSpeed = 1.5;
let minPipeHeight = 40;
let pipeSpawnRate = 150;
let nextPipe = 100;
let pipeVariants = ['normal', 'moving', 'rotating'];

// Power-up configuration
let activePowerUp = null;
let powerUpDuration = 0;
let powerUpSpawnRate = 800; // Less frequent than pipes
let nextPowerUp = powerUpSpawnRate;

// Game Audio
const audioContext = new (window.AudioContext || window.webkitAudioContext)();
const sounds = {
    jump: null,
    score: null,
    death: null,
    powerUp: null,
    munchie: null
};

// Initialize sounds
function initSounds() {
    // Simple oscillator for jump sound
    sounds.jump = () => {
        if (muted) return;
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(880, audioContext.currentTime);
        oscillator.frequency.exponentialRampToValueAtTime(440, audioContext.currentTime + 0.1);
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        oscillator.start();
        oscillator.stop(audioContext.currentTime + 0.2);
    };
    
    // Score sound
    sounds.score = () => {
        if (muted) return;
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        oscillator.type = 'sine';
        oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        oscillator.start();
        oscillator.stop(audioContext.currentTime + 0.3);
    };
    
    // Death sound
    sounds.death = () => {
        if (muted) return;
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        oscillator.type = 'sawtooth';
        oscillator.frequency.setValueAtTime(110, audioContext.currentTime);
        oscillator.frequency.exponentialRampToValueAtTime(55, audioContext.currentTime + 0.5);
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        oscillator.start();
        oscillator.stop(audioContext.currentTime + 0.5);
    };
    
    // Power-up sound
    sounds.powerUp = () => {
        if (muted) return;
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        oscillator.type = 'square';
        oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
        oscillator.frequency.exponentialRampToValueAtTime(880, audioContext.currentTime + 0.2);
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        oscillator.start();
        oscillator.stop(audioContext.currentTime + 0.3);
    };
    
    // Munchie sound
    sounds.munchie = () => {
        if (muted) return;
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        oscillator.type = 'triangle';
        oscillator.frequency.setValueAtTime(660, audioContext.currentTime);
        oscillator.frequency.exponentialRampToValueAtTime(440, audioContext.currentTime + 0.15);
        gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.15);
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        oscillator.start();
        oscillator.stop(audioContext.currentTime + 0.15);
    };
}

// Initialize game
function init() {
    highScoreDisplay.textContent = `Best: ${highScore}`;
    initSounds();
    setupEventListeners();
    populateCharacterSelect();
    drawBackground();
    
    // Create initial clouds
    for (let i = 0; i < 5; i++) {
        createCloud(Math.random() * canvas.width);
    }
    
    // Draw weed character on start screen
    weed.draw();
}

// Weed character object
const weed = {
    x: 50,
    y: canvas.height / 2,
    width: 40,
    height: 30,
    velocity: 0,
    rotation: 0,
    floatOffset: 0,
    floatSpeed: 0.05,
    smokeTimer: 0,
    
    update: function(deltaTime) {
        // Apply gravity with delta time for consistent physics
        this.velocity += gravity * deltaTime * gameSpeed;
        
        // Limit falling speed
        if (this.velocity > terminalVelocity) {
            this.velocity = terminalVelocity;
        }
        
        // Update floating effect
        this.floatOffset += this.floatSpeed * deltaTime * gameSpeed;
        let floatEffect = Math.sin(this.floatOffset) * 0.5;
        
        // Update position
        this.y += (this.velocity + floatEffect) * deltaTime * gameSpeed;
        
        // Update rotation based on velocity
        const targetRotation = (this.velocity / terminalVelocity) * Math.PI * 0.25;
        this.rotation += (targetRotation - this.rotation) * 0.1 * deltaTime;
        
        // Create smoke particles when moving upward
        this.smokeTimer -= deltaTime;
        if (this.velocity < 0 && this.smokeTimer <= 0) {
            createSmokeParticle(this.x - this.width/2, this.y);
            this.smokeTimer = 10;
        }
        
        // Collision with ground
        if (this.y + this.height/2 > canvas.height - 20) {
            this.y = canvas.height - 20 - this.height/2;
            this.velocity = 0;
            gameOver();
        }
        
        // Collision with ceiling
        if (this.y - this.height/2 < 0) {
            this.y = this.height/2;
            this.velocity = 0;
        }
    },
    
    jump: function() {
        this.velocity = jumpForce;
        this.smokeTimer = 0; // Reset smoke timer to create particles immediately
    },
    
    reset: function() {
        this.y = canvas.height / 3;
        this.velocity = -1;
        this.floatOffset = 0;
        this.rotation = 0;
    },
    
    draw: function() {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.rotation);
        
        // Draw based on character type
        switch(characterType) {
            case 'purple':
                this.drawPurpleLeaf();
                break;
            case 'gold':
                this.drawGoldLeaf();
                break;
            default: // 'green'
                this.drawGreenLeaf();
        }
        
        // Draw power-up effect if active
        if (activePowerUp) {
            ctx.beginPath();
            ctx.arc(0, 0, this.width/1.5, 0, Math.PI * 2);
            
            if (activePowerUp === 'slowPuff') {
                ctx.fillStyle = 'rgba(0, 100, 255, 0.2)';
            } else if (activePowerUp === 'highGlide') {
                ctx.fillStyle = 'rgba(255, 215, 0, 0.2)';
            }
            
            ctx.fill();
        }
        
        ctx.restore();
    },
    
    drawGreenLeaf: function() {
        // Main leaf shape
        ctx.fillStyle = '#44A244';
        ctx.beginPath();
        ctx.ellipse(0, 0, this.width/2, this.height/2, 0, 0, Math.PI * 2);
        ctx.fill();
        
        // Leaf veins
        ctx.strokeStyle = '#2E7D32';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(-this.width/3, 0);
        ctx.lineTo(this.width/3, 0);
        ctx.stroke();
        
        ctx.beginPath();
        ctx.moveTo(0, -this.height/3);
        ctx.lineTo(0, this.height/3);
        ctx.stroke();
        
        // Leaf details
        ctx.fillStyle = '#388E3C';
        // Left leaf part
        ctx.beginPath();
        ctx.moveTo(-this.width/2, 0);
        ctx.lineTo(-this.width/4, -this.height/4);
        ctx.lineTo(0, 0);
        ctx.fill();
        
        // Right leaf part
        ctx.beginPath();
        ctx.moveTo(this.width/2, 0);
        ctx.lineTo(this.width/4, -this.height/4);
        ctx.lineTo(0, 0);
        ctx.fill();
        
        // Bottom leaf part
        ctx.beginPath();
        ctx.moveTo(-this.width/3, this.height/3);
        ctx.lineTo(0, this.height/2);
        ctx.lineTo(this.width/3, this.height/3);
        ctx.fill();
    },
    
    drawPurpleLeaf: function() {
        // Main leaf shape
        ctx.fillStyle = '#8A2BE2';
        ctx.beginPath();
        ctx.ellipse(0, 0, this.width/2, this.height/2, 0, 0, Math.PI * 2);
        ctx.fill();
        
        // Leaf veins
        ctx.strokeStyle = '#4B0082';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(-this.width/3, 0);
        ctx.lineTo(this.width/3, 0);
        ctx.stroke();
        
        ctx.beginPath();
        ctx.moveTo(0, -this.height/3);
        ctx.lineTo(0, this.height/3);
        ctx.stroke();
        
        // Leaf details
        ctx.fillStyle = '#9370DB';
        // Leaf parts
        ctx.beginPath();
        ctx.moveTo(-this.width/2, 0);
        ctx.lineTo(-this.width/4, -this.height/4);
        ctx.lineTo(0, 0);
        ctx.fill();
        
        ctx.beginPath();
        ctx.moveTo(this.width/2, 0);
        ctx.lineTo(this.width/4, -this.height/4);
        ctx.lineTo(0, 0);
        ctx.fill();
        
        ctx.beginPath();
        ctx.moveTo(-this.width/3, this.height/3);
        ctx.lineTo(0, this.height/2);
        ctx.lineTo(this.width/3, this.height/3);
        ctx.fill();
    },
    
    drawGoldLeaf: function() {
        // Main leaf shape
        ctx.fillStyle = '#FFD700';
        ctx.beginPath();
        ctx.ellipse(0, 0, this.width/2, this.height/2, 0, 0, Math.PI * 2);
        ctx.fill();
        
        // Leaf veins
        ctx.strokeStyle = '#B8860B';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(-this.width/3, 0);
        ctx.lineTo(this.width/3, 0);
        ctx.stroke();
        
        ctx.beginPath();
        ctx.moveTo(0, -this.height/3);
        ctx.lineTo(0, this.height/3);
        ctx.stroke();
        
        // Leaf details
        ctx.fillStyle = '#DAA520';
        // Leaf parts
        ctx.beginPath();
        ctx.moveTo(-this.width/2, 0);
        ctx.lineTo(-this.width/4, -this.height/4);
        ctx.lineTo(0, 0);
        ctx.fill();
        
        ctx.beginPath();
        ctx.moveTo(this.width/2, 0);
        ctx.lineTo(this.width/4, -this.height/4);
        ctx.lineTo(0, 0);
        ctx.fill();
        
        ctx.beginPath();
        ctx.moveTo(-this.width/3, this.height/3);
        ctx.lineTo(0, this.height/2);
        ctx.lineTo(this.width/3, this.height/3);
        ctx.fill();
    }
};

// Create a pipe
function createPipe() {
    const minHeight = minPipeHeight;
    const maxHeight = canvas.height - pipeGap - minHeight;
    const height = Math.floor(Math.random() * (maxHeight - minHeight)) + minHeight;
    
    // Randomly select pipe variant
